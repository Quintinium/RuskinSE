<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0048)http://english.selu.edu/humanitiesonline/ruskin/ -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	
	<title>The Early Ruskin Manuscripts, Advanced Search Results</title>
	<link href="./The Early Ruskin Manuscripts, 1826–1842_files/styles.css" rel="stylesheet" type="text/css">
	<link rel="icon" type="image/png" href="http://english.selu.edu/humanitiesonline/ruskin/images/ruskin_icon.png">
</head>
<body>
		<div class="navigation">
        <a href="http://english.selu.edu/humanitiesonline/ruskin/index.php"><img src="./The Early Ruskin Manuscripts, 1826–1842_files/ruskin_logo.jpg" width="100%"></a>
        <br>
		<br>
        <span class="navigation-title">
            The
            <br>Early
            <br>Ruskin
            <br>Manuscripts
            <div class="navigation-date">1826–1842</div>
        </span>
        <hr>
        <span class="navigation-editor"><a href="mailto:ruskinproject@selu.edu">David C. Hanson, Editor</a></span>
        <br>
        <br>
        <span><a href="http://english.selu.edu/humanitiesonline/ruskin/index.php">Home</a><span>
        <span>
        	<br><a href="http://english.selu.edu/humanitiesonline/ruskin/essays/indices_essay.php">Indices</a>
            <br><a class="subnavigation" href="http://english.selu.edu/humanitiesonline/ruskin/essays/indices_essay.php#WORKS">Works</a>
            <br><a class="subnavigation" href="http://english.selu.edu/humanitiesonline/ruskin/essays/indices_essay.php#MANUSCRIPTS">Manuscripts</a>
            <br><a class="subnavigation" href="http://english.selu.edu/humanitiesonline/ruskin/essays/indices_essay.php#CORPORA">Corpora</a>
            <br><a class="subnavigation" href="http://english.selu.edu/humanitiesonline/ruskin/essays/indices_essay.php#WORKSBYOTHERS">Works by Others</a>
            <br><a class="subnavigation" href="http://english.selu.edu/humanitiesonline/ruskin/essays/indices_essay.php#COMMENTARY">Commentary</a>
            <br><a class="tion" href="http://english.selu.edu/humanitiesonline/ruskin/essays/indices_essay.php#ESSAYS">Essays</a>
        </span>
        <br>
		<span>XML</span>        <br>
		<span>Bibliography</span>
        <br>
        <span><a href="http://english.selu.edu/humanitiesonline/ruskin/webpages/staff.php">Staff and Support</a><span>
        <br>
        <span><a href="http://english.selu.edu/humanitiesonline/ruskin/webpages/legal.php">Legal</a><span>
		 <br>
        <span><a href="http://localhost/search.php">Advanced Search</a><span>
	</span></span></span></span></span></span></span></span></div>
	
	<div class="content">
	<form action="http://localhost/Backend.php" method="post">
			<fieldset>
			<legend>Search</legend>
			Keyword(s): <input type="text" name="keyword" /><input type="submit" name="submit" value=" Search " class="button"/><br /><br />
			<input type="checkbox" name="is_poem_document" value="true" /> Is a poem?<br />
			<input type="checkbox" name="activate_document_filter" value="true" />Show documents that are:
			<select name="divtype_document"> 
				<option value="apparatus">Apparatus</option>
				<option value="poem">Poem</option>
				<option value="note">Note</option>
			</select><br />
			<input type="checkbox" name="full_text_of_document" value="true" /> Search full text<br />
			<input type="checkbox" name="activate_tag_filter" value="true" />Show results if keyword is a:
			<select name="tag_keywords">				
				<option value="persName">Person Name</option>
				<option value="geogName">Geographical Name</option>
				<option value="placeName">Place Name</option>
				<option value="orgName">Organization Name</option>
				<option value="title">Title</option>
				<option value="name">Name</option>
				<option value="date">Date</option>
			</select>
			of a: 
			<select name="type_keywords">
				<option value="aa">Anything/Anyone</option>
				<option value="book">Book</option>
				<option value="poem">Poem</option>
				<option value="pen_name">Pen Name</option>
				<option value="periodical">Periodical</option>
				<option value="essay">Essay</option>
				<option value="bibliography">Bibliography</option>
				<option value="prose">Prose</option>
				<option value="archive">Archive</option>
				<option value="engraving">Engraving</option>
				<option value="collected_poems">Collected Poems</option>
				<option value="collected_sketches">Collected Sketches</option>
				<option value="anthology">Anthology</option>
				<option value="reference">Reference</option>
				<option value="biography">Biography</option>
				<option value="novel">Novel</option>
				<option value="magazine">Magazine</option>
				<option value="drama">Drama</option>
				<option value="collected_letters">Collected Letters</option>
				<option value="autobiography">Autobiography</option>
				<option value="bibliography_text">Bibliography Text</option>
				<option value="manuscript">Manuscript</option>
				<option value="program">Program</option>
				<option value="lesson">Lesson</option>
				<option value="gloss">Gloss</option>
				<option value="composite">Composite</option>
				<option value="sermon">Sermon</option>
				<option value="archive_digital">Archive Digital</option>
				<option value="archive_nondigital">Archive Non-Digital</option>
				<option value="series">Series</option>
				<option value="fictional">Fictional</option>
				<option value="story">Story</option>
				<option value="peom">Peom</option>
				<option value="architecture">Architecture</option>
				<option value="collected_works">Collected Works</option>
				<option value="painting">Painting</option>
				<option value="letter">Letter</option>
				<option value="guidebook">Guidebook</option>
				<option value="constellation">Constellation</option>
				<option value="book_chapter">Book Chapter</option>
				<option value="memoir">Memoir</option>
				<option value="composition">Composition</option>
				<option value="work">Work</option>
				<option value="scripture">Scripture</option>
				<option value="drawing">Drawing</option>
				<option value="collected_art">Collected Art</option>
				<option value="sketch">Sketch</option>
				<option value="map">Map</option>
				<option value="catalog_auction">Catalog Auction</option>
				<option value="dictionary">Dictionary</option>
				<option value="ana">Ana</option>
				<option value="collecte_poems">Collected Poems</option>
				<option value="tale">Tale</option>
				<option value="other">Other</option>
				<option value="article">Article</option>
			</select><br />
			
		</fieldset></form>
<?php

// Load MySQL credentials from config file.
include('config.php');

mysql_connect($servername, $username, $password);
mysql_select_db($database);

if (isset($_POST['keyword'])) {
	
	// Check to make sure the user searched for a keyword that is at least 3 characters long.
	if (strlen($_POST['keyword']) < 3) {
		die('<br /><span style="font-weight: bold; color: red;">Sorry, please try searching with a keyword that is at least 3 characters long.</span>');
	}
	
	// This is our base query. We will add constraints to make this query longer
	// depending on which filters are active.
 	$query = 'SELECT * FROM `documents`, `keywords` WHERE `documents`.`id`=`keywords`.`docid` ';
	
	echo '<br />';
	echo "Keyword: " . $_POST['keyword'];
	echo '<br />';
	
	echo 'Poem: ';	
	
	if (isset($_POST['is_poem_document'])) {
		$query .= 'AND `documents`.`ispoem` = 1 ';
	} else {
		echo 'Failed';
	}
	
	echo '<br />Document Filter: ';
	
	if (isset($_POST['activate_document_filter'])) {
		$query .= "AND `documents`.`divtype` LIKE '" . $_POST['divtype_document'] . "' ";
	} else {
		echo 'Failed';
	}	
	
	echo '<br />Divtype Document: ' . $_POST['divtype_document'];
	
	echo '<br />Full Text: ';
	
	if (isset($_POST['full_text_of_document'])) {
		$query .= "AND `documents`.`text` LIKE '%" . $_POST['keyword'] . "%' ";
	} else {
		$query .= "AND `keywords`.`content` LIKE '%" . $_POST['keyword'] . "%' ";
	}
	
	echo '<br />Tag Filter: '; 
	
	if (isset($_POST['activate_tag_filter'])) {
		$query .= "AND `keywords`.`tag` LIKE '%" .$_POST['tag_keywords']."%' ";
	}
	
	if ($_POST['type_keywords'] !='aa'){
			$query .= "AND `keywords`.`type` LIKE '%" .$_POST['type_keywords']."%' ";
	}
	echo '<br />Tag Keyword: ' . $_POST['tag_keywords'] . '<br />Type Keyword: ' . $_POST['type_keywords'];

	
	// Finds all poems, and then from these peoms, search for the ones with a title containing "Calais"
	// SELECT * FROM (SELECT * FROM `documents` WHERE `ispoem` = '1') AS my_first_query WHERE `title` LIKE '%Calais%'
	
	// SELECT * FROM `keywords` WHERE `docid` IN (SELECT `id` AS `docid` FROM `documents` WHERE `ispoem` = 1) AND `tag` LIKE '%persName%'
	// Look in the documents table, and find all documents that are peoms. Then grab the id, and rename this to docid. Then using this list of docids, fetch all keywords
	// that exist in one of those documents IF that keyword is a persName keyword.
	
	// SELECT * FROM `documents`, `keywords` WHERE `documents`.`id`=`keywords`.`docid` AND `documents`.`ispoem` = 1 AND `keywords`.`tag` LIKE '%persName%'
	// Here is an easier implementation of the query above.
	
	echo 'Here is our query: ' . $query;
	
	$results = mysql_query($query);
	
	echo '<div class="container results-container">
	<h2>Search results for <span class="italic">"Ruskin"</span> :</h2>
			<div class="divider"></div>';
			
	while ($row = mysql_fetch_assoc($results)) {
		echo '<div class="result-container">
				<b>Location:</b> <a class="italic" href="' . $row['url'] . '">' . $row['url'] . '</a><br />
				<b>Matching text:</b> <span class="italic">' . $_POST['keyword'] . '</span><br />
				<b>Document type:</b> ' . $row['divtype'] . '
			</div>';
	}
	echo '</div>';
}

?></div>
	</body>
</html>